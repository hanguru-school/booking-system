# 학번 생성 규정 (Student ID Generation Policy)

## 📋 개요

MalMoi 한국어교실의 학번(Student ID)은 입회 시점을 기준으로 자동 생성됩니다.

## 🎯 학번 형식

### 기본 형식
```
YYMMDDXXHH
```

### 구성 요소
- **YY**: 입회 연도의 마지막 2자리 (예: 25 = 2025년)
- **MM**: 입회 월 (01-12)
- **DD**: 입회 일 (01-31)
- **XX**: 해당 일의 순번 (01부터 시작, 2자리 숫자)
- **HH**: 입회 시간 (00-23, 24시간 형식)

## 📝 예시

### 2025년 1월 15일 예시
- `2501150114`: 2025년 1월 15일, 첫 번째 학생, 14시 입회
- `2501150215`: 2025년 1월 15일, 두 번째 학생, 15시 입회
- `2501150310`: 2025년 1월 15일, 세 번째 학생, 10시 입회

### 2025년 10월 21일 예시
- `2510210109`: 2025년 10월 21일, 첫 번째 학생, 09시 입회
- `2510215016`: 2025년 10월 21일, 50번째 학생, 16시 입회

### 학번 해석 예시
- `2501150114` 
  - 입회 연도: **2025년**
  - 입회 월: **1월**
  - 입회 일: **15일**
  - 해당일 순번: **01번째**
  - 입회 시간: **14시**

## 🔧 생성 로직

### 1. 자동 생성
- 입회 신청 시 자동으로 생성됩니다
- 시스템이 현재 날짜와 시간을 기준으로 YYMMDD와 HH를 결정합니다
- 해당 일의 마지막 순번을 조회하여 +1 합니다

### 2. 순번 관리
- 각 일별로 01부터 시작합니다
- 하루 최대 99명까지 수용 가능합니다
- 순번은 연속적으로 증가합니다 (결번 없음)

### 3. 고유성 보장
- `studentId` 필드는 데이터베이스에서 `@unique` 제약조건을 가집니다
- 동시 등록 시에도 중복이 발생하지 않습니다
- 같은 날 같은 시간이라도 순번(XX)으로 구분됩니다

### 4. 시간 정보
- HH는 입회 신청 시점의 시간(24시간 형식)을 기록합니다
- 예: 오전 9시 → 09, 오후 3시 → 15, 오후 11시 → 23

## 🔐 초기 비밀번호

### 생성 규칙
학생의 **핸드폰 번호 뒤 4자리**를 기반으로 초기 비밀번호가 생성됩니다.

### 형식
```
핸드폰 번호의 마지막 4자리 숫자
```

### 예시
- 핸드폰: 090-1234-5678 → 초기 비밀번호: `5678`
- 핸드폰: 080-9999-1234 → 초기 비밀번호: `1234`
- 핸드폰: 070-5555-7890 → 초기 비밀번호: `7890`

### 보안 정책
- ⚠️ **필수**: 첫 로그인 시 자동으로 비밀번호 재설정 페이지로 이동합니다
- 초기 비밀번호는 입회 완료 메시지에 표시됩니다
- 비밀번호는 bcrypt로 해시되어 저장됩니다
- 비밀번호 재설정 후 개인정보 수정 페이지로 자동 이동합니다

## 📊 데이터베이스 스키마

```prisma
model Student {
  id                    String      @id @default(cuid())
  studentId             String?     @unique // 학번 (MMYY-XXX 형식)
  // ... 기타 필드들
}
```

## 🔄 입회 및 로그인 프로세스

### 입회 프로세스

#### 1단계: 입회 신청
- 학생이 입회 정보를 입력합니다
- 시스템이 자동으로 학번을 생성합니다 (YYMMDDXXHH 형식)
- 초기 비밀번호가 핸드폰 번호 뒤 4자리로 생성됩니다

#### 2단계: 규정 동의
- 생성된 학번으로 교실 규정 동의 페이지에 접근합니다
- 10개 교실 규정에 동의하고 디지털 서명을 합니다

#### 3단계: 입회 완료
- 동의서가 제출되면 `enrollmentStatus`가 `COMPLETED`로 변경됩니다
- 입회 서류가 이메일로 전송됩니다

### 로그인 프로세스

#### 로그인 방법 (2가지)
1. **이메일 + 비밀번호**
2. **학번 + 비밀번호**

#### 첫 로그인 시
1. **이메일 또는 학번** + **초기 비밀번호**(핸드폰 뒤 4자리)로 로그인
2. 자동으로 **비밀번호 재설정 페이지**로 이동
3. 새로운 비밀번호 설정 (최소 8자, 대소문자/숫자/특수문자 포함 권장)
4. 자동으로 **개인정보 수정 페이지**로 이동
5. 추가 정보 입력 (선택사항)

#### 재로그인 시
- 이메일 또는 학번 + 새 비밀번호로 로그인
- 역할에 따라 해당 대시보드로 이동
  - 학생(STUDENT) → `/student`
  - 선생님(TEACHER) → `/teacher`
  - 직원(EMPLOYEE/STAFF) → `/employee`
  - 관리자(ADMIN) → `/admin`

## 🎓 학번 활용

### 로그인
- **학번** 또는 **이메일** + 비밀번호로 로그인 가능
- 예시: `2501150114` + `5678` (첫 로그인)
- 예시: `tanaka@example.com` + `NewPassword123!` (재로그인)

### 학생 식별
- 모든 학생 관련 문서에 학번이 표시됩니다
- 예약, 출석, 성적 등 모든 기록에 학번이 연결됩니다

### 관리자 조회
- 관리자는 학번으로 학생을 빠르게 검색할 수 있습니다
- 학번은 입회 시기를 알려주는 정보도 포함합니다

## 🛠️ API 엔드포인트

### POST /api/students/register
입회 신청 및 학번 생성

**요청 본문:**
```json
{
  "nameKanji": "田中太郎",
  "nameYomigana": "タナカタロウ",
  "birthDate": "1990-05-15",
  "phone": "090-1234-5678",
  "email": "tanaka@example.com",
  // ... 기타 필드들
}
```

**응답:**
```json
{
  "success": true,
  "token": "...",
  "initialPassword": "5678",
  "student": {
    "studentId": "2501150114",
    "nameKanji": "田中太郎",
    // ... 기타 정보
  }
}
```

### POST /api/auth/login
로그인 (이메일 또는 학번)

**요청 본문 (이메일):**
```json
{
  "email": "tanaka@example.com",
  "password": "5678"
}
```

**요청 본문 (학번):**
```json
{
  "email": "2501150114",
  "password": "5678"
}
```

**응답:**
```json
{
  "success": true,
  "message": "로그인 성공",
  "user": {
    "id": "...",
    "email": "tanaka@example.com",
    "name": "田中太郎",
    "role": "STUDENT"
  },
  "isFirstLogin": true,
  "redirectUrl": "/auth/reset-password"
}
```

### POST /api/auth/reset-password
비밀번호 재설정 (첫 로그인 시)

**요청 본문:**
```json
{
  "newPassword": "NewPassword123!"
}
```

**응답:**
```json
{
  "success": true,
  "message": "비밀번호가 성공적으로 변경되었습니다.",
  "role": "STUDENT"
}
```

## ⚙️ 설정 파일

### 환경 변수
```env
DATABASE_URL=postgresql://...
EMAIL_USER=your-email@gmail.com
EMAIL_PASS=your-app-password
```

## 📌 주의사항

1. **학번 변경 불가**: 한번 생성된 학번은 변경할 수 없습니다
2. **생년월일 정확성**: 초기 비밀번호는 생년월일 기반이므로 정확해야 합니다
3. **일별 최대 인원**: 하루에 99명까지만 등록 가능합니다 (초과 시 시스템 관리자에게 문의)
4. **시스템 시간**: 서버의 시스템 시간을 기준으로 YYMMDD와 HH가 결정됩니다
5. **10자리 고정**: 학번은 항상 10자리 숫자로 구성됩니다

## 📞 문의

학번 관련 문의사항은 관리자에게 연락해주세요.

